<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QR Code Generator</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      background-color: #f0f0f0;
    }
    main {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }
    #qr-text {
      width: 80%;
      max-width: 300px;
      padding: 10px;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    #upload-area {
      border: 2px dashed #ccc;
      padding: 20px;
      margin: 10px 0;
      cursor: pointer;
      background-color: #fff;
      text-align: center;
      width: 80%;
      max-width: 300px;
    }
    #upload-area.dragover {
      background-color: #e0e0e0;
    }
    #preview-container {
      position: relative;
      width: 80vw;
      max-width: 300px;
      height: 80vw;
      max-height: 300px;
      border: 1px solid #000;
      background-color: #fff;
    }
    #qr-canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
    #logo-container {
      position: absolute;
      cursor: move;
      display: none;
    }
    #logo-image {
      width: 100%;
      height: 100%;
    }
    #controls {
      margin: 10px 0;
    }
    #download-btn {
      padding: 10px 20px;
      background-color: #007bff;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    #download-btn:hover {
      background-color: #0056b3;
    }
  </style>
</head>
<body>
  <main>
    <input type="text" id="qr-text" placeholder="Enter text for QR code">
    <div id="upload-area">
      <p>Drag and drop or click to upload logo</p>
      <input type="file" id="logo-upload" accept="image/*">
    </div>
    <div id="controls">
      <label for="scale-slider">Logo scale:</label>
      <input type="range" id="scale-slider" min="0.1" max="2" step="0.1" value="1">
    </div>
    <div id="preview-container">
      <canvas id="qr-canvas"></canvas>
      <div id="logo-container">
        <img id="logo-image" src="" alt="Logo">
      </div>
    </div>
    <button id="download-btn">Download QR Code</button>
  </main>
  <script>
    const qrCanvas = document.getElementById('qr-canvas');
    const qrText = document.getElementById('qr-text');
    const logoUpload = document.getElementById('logo-upload');
    const logoImage = document.getElementById('logo-image');
    const scaleSlider = document.getElementById('scale-slider');
    const logoContainer = document.getElementById('logo-container');
    const previewContainer = document.getElementById('preview-container');
    const uploadArea = document.getElementById('upload-area');
    const downloadBtn = document.getElementById('download-btn');

    // Initialize QRious with dynamic size
    let qr = new QRious({
      element: qrCanvas,
      value: '',
      size: previewContainer.clientWidth,
    });

    // Update QR code when text changes
    qrText.addEventListener('input', () => {
      qr.value = qrText.value;
    });

    // Variables for logo handling
    let initialWidth, initialHeight;
    let isDragging = false;
    let startX, startY;

    // Handle file input logo upload
    logoUpload.addEventListener('change', (event) => {
      const file = event.target.files[0];
      if (file) {
        loadLogo(file);
      }
    });

    // Handle drag-and-drop
    uploadArea.addEventListener('dragover', (event) => {
      event.preventDefault();
      uploadArea.classList.add('dragover');
    });

    uploadArea.addEventListener('dragleave', (event) => {
      uploadArea.classList.remove('dragover');
    });

    uploadArea.addEventListener('drop', (event) => {
      event.preventDefault();
      uploadArea.classList.remove('dragover');
      const file = event.dataTransfer.files[0];
      if (file && file.type.startsWith('image/')) {
        loadLogo(file);
      }
    });

    // Load and position logo
    function loadLogo(file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        logoImage.src = e.target.result;
        logoImage.onload = () => {
          initialWidth = logoImage.naturalWidth;
          initialHeight = logoImage.naturalHeight;
          const scale = 0.5; // Initial scale
          logoContainer.style.width = `${initialWidth * scale}px`;
          logoContainer.style.height = `${initialHeight * scale}px`;
          const containerWidth = previewContainer.clientWidth;
          const containerHeight = previewContainer.clientHeight;
          logoContainer.style.left = `${(containerWidth - initialWidth * scale) / 2}px`;
          logoContainer.style.top = `${(containerHeight - initialHeight * scale) / 2}px`;
          logoContainer.style.display = 'block';
        };
      };
      reader.readAsDataURL(file);
    }

    // Scale logo with slider
    scaleSlider.addEventListener('input', () => {
      const scale = parseFloat(scaleSlider.value);
      logoContainer.style.width = `${initialWidth * scale}px`;
      logoContainer.style.height = `${initialHeight * scale}px`;
    });

    // Drag logo
    logoContainer.addEventListener('mousedown', (event) => {
      isDragging = true;
      startX = event.clientX - logoContainer.offsetLeft;
      startY = event.clientY - logoContainer.offsetTop;
    });

    document.addEventListener('mousemove', (event) => {
      if (isDragging) {
        let x = event.clientX - startX;
        let y = event.clientY - startY;
        const minX = 0;
        const minY = 0;
        const maxX = previewContainer.clientWidth - logoContainer.offsetWidth;
        const maxY = previewContainer.clientHeight - logoContainer.offsetHeight;
        x = Math.max(minX, Math.min(x, maxX));
        y = Math.max(minY, Math.min(y, maxY));
        logoContainer.style.left = `${x}px`;
        logoContainer.style.top = `${y}px`;
      }
    });

    document.addEventListener('mouseup', () => {
      isDragging = false;
    });

    // Download combined image
    downloadBtn.addEventListener('click', () => {
      const tempCanvas = document.createElement('canvas');
      tempCanvas.width = qrCanvas.width;
      tempCanvas.height = qrCanvas.height;
      const ctx = tempCanvas.getContext('2d');
      ctx.drawImage(qrCanvas, 0, 0);
      if (logoImage.src) {
        const logoX = parseFloat(logoContainer.style.left);
        const logoY = parseFloat(logoContainer.style.top);
        const logoWidth = parseFloat(logoContainer.style.width);
        const logoHeight = parseFloat(logoContainer.style.height);
        ctx.drawImage(logoImage, logoX, logoY, logoWidth, logoHeight);
      }
      const dataURL = tempCanvas.toDataURL('image/png');
      const link = document.createElement('a');
      link.href = dataURL;
      link.download = 'qr-code.png';
      link.click();
    });

    // Resize preview with UI
    window.addEventListener('resize', () => {
      const size = previewContainer.clientWidth;
      qr.size = size;
      qrCanvas.width = size;
      qrCanvas.height = size;
      qr.value = qrText.value; // Redraw QR code
    });
  </script>
</body>
</html>
